var comeHere = {"files":[{"id":"8b0901bf-1987-42eb-ac59-3cfa38d02e17","name":"Code","type":"server_js","source":"// To be launched as a web page, this project\n// must contains a doGet or doPost function.\n\nfunction doGet() {\n  return HtmlService.createHtmlOutputFromFile(\"Index\");\n}\n\nfunction getMessages() {\n  setup();\n  var label \u003d GmailApp.getUserLabelByName(myLabel);\n  var threads \u003d label.getThreads();\n  var current \u003d [];\n  for (var i \u003d 0; i \u003c threads.length; i++) {\n    var thread \u003d threads[i];\n    var message \u003d thread.getMessages()[0]; // just first message\n    var msgId \u003d message.getId();\n    var msgUnread \u003d thread.isUnread()\n    if (msgUnread || (myPrevious.indexOf(msgId) !\u003d -1)) {\n      current[current.length] \u003d msgId;\n      Logger.log(message.getFrom());\n      putImage(message);\n      if (msgUnread) {\n        message.markRead();\n      }\n    }\n  }\n  setPrevious(current.join(\" \"));\n  return (\"Found \" + current.length + \" comics.\u003cp\u003e\")\n    + myImages.join(\"\\n\") + myOthers.join(\"\\n\");\n}\n\nfunction putImage(aMessage) {\n  var subject \u003d aMessage.getSubject();\n  var key \u003d getKey(subject);\n  var image \u003d subject + getImage(aMessage) + \"\u003cbr\u003e\";\n  if (key \u003d\u003d -1) {\n    myOthers.unshift(image);\n  } else {\n    if (\"\\n\" \u003d\u003d myImages[key].substring(0, 1)) {\n      myImages[key] \u003d image;\n    } else {\n      myImages[key] \u003d image + myImages[key];\n    }\n  }\n}\n\nfunction getKey(aSubject) {\n  var key \u003d aSubject.indexOf(\" for \");\n  if (key !\u003d -1) {\n    key \u003d myOrder.indexOf(aSubject.substring(0, key));\n  }\n  return key;\n}\n\nfunction getImage(aMessage) {\n  var image \u003d aMessage.getBody();\n  var imageEnd \u003d image.indexOf(\"\u003eTwitter\u003c\");\n  var imageBegin \u003d image.lastIndexOf(\"\u003ctable\", imageEnd);\n  imageEnd \u003d 8 + image.indexOf(\"\u003c/table\u003e\", imageEnd);\n  return image.substring(imageBegin, imageEnd);\n}"},{"id":"837220e9-4fda-4bf3-bac8-11bf9d7bb760","name":"Index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\u003chead\u003e\u003cbase target\u003d\"_top\"\u003e\u003cscript\u003e\nfunction clickConfig() {\n  var btnCfg \u003d document.getElementById(\"buttonConfig\");\n  if (btnCfg.value \u003d\u003d \"Config\") {\n    btnCfg.value \u003d \"Reconfig\";\n    document.getElementById(\"outputConfig\")\n      .innerHTML \u003d \n      \u0027\u003ctable\u003e\u003ctr\u003e\u003ctd width\u003d\"50%\" align\u003d\"right\"\u003egMail Label:\u003c/td\u003e\u0027 +\n      \u0027\u003ctd\u003e\u003cinput type\u003d\"Text\" id\u003d\"outputLabel\" size\u003d\"32\" /\u003e\u003c/td\u003e\u003c/tr\u003e\u0027 +\n      \u0027\u003ctr\u003e\u003ctd width\u003d\"50%\" align\u003d\"right\"\u003eOrder of Comics:\u003c/td\u003e\u0027 + \n      \u0027\u003ctd\u003e\u003ctextarea id\u003d\"outputOrder\" rows\u003d\"12\" cols\u003d\"42\"\u003e\u003c/textarea\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\u0027;\n      \n    google.script.run\n      .withFailureHandler(onFailure)\n      .withSuccessHandler(onConfig)  \n      .getConfig();\n      \n  } else {\n    var config \u003d {};\n    config.label \u003d document.getElementById(\"outputLabel\").value;\n    config.order \u003d document.getElementById(\"outputOrder\").value\n      .trim().split(\"\\n\").join(\";\");\n\n    google.script.run\n      .withFailureHandler(onFailure)\n      .withSuccessHandler(onConfigured)\n      .setConfig(config);\n  }\n}\n\nfunction onConfig(aMsg) {\n  document.getElementById(\"outputLabel\").value \u003d aMsg.label;        \n  document.getElementById(\"outputOrder\").value \u003d aMsg.order.split(\";\").join(\"\\n\");\n}\n\nfunction onConfigured(aMsg) {\n  document.getElementById(\"outputError\").innerHTML \u003d aMsg;\n}\n\nfunction clickFinish() {\n  var btnFin \u003d document.getElementById(\"buttonFinish\");\n  if (btnFin.value !\u003d \"Done\") {\n    btnFin.value \u003d \"Done\";\n\n    google.script.run\n      .withFailureHandler(onFailure)\n      .withSuccessHandler(onConfigured)\n      .setPrevious(\"\");\n  } else {\n    prompt(\"New Day was Done\");\n  }\n}\n\nfunction onFailure(aMsg) {\n  document.getElementById(\"outputError\").innerHTML \u003d \"ERROR: \" + aMsg.message;\n}\n\nfunction onSuccess(aMsg) {\n  if (aMsg.substring(6,7) !\u003d \"0\") {\n    aMsg +\u003d \u0027\u003cp\u003e\u003cinput id\u003d\"buttonFinish\" type\u003d\"button\"\u0027\n      + \u0027 onclick\u003d\"clickFinish()\" value\u003d\"\u0027\n      + aMsg.substring(0, aMsg.indexOf(\".\")) + \u0027\"\u003e\u003cp\u003e\u0027;\n  }\n  document.getElementById(\"outputImages\").innerHTML \u003d aMsg;\n}\n\n  google.script.run\n    .withFailureHandler(onFailure)\n    .withSuccessHandler(onSuccess)\n    .getMessages();\n\u003c/script\u003e\u003c/head\u003e\n\n\u003cbody\u003e\u003ccenter\u003e\n  \u003cdiv id\u003d\"outputError\"\u003e\u003c/div\u003e\u003cbr\u003e\n  \u003cdiv id\u003d\"outputConfig\"\u003e\u003c/div\u003e\n  \u003cinput id\u003d\"buttonConfig\" type\u003d\"button\" onclick\u003d\"clickConfig()\" value\u003d\"Config\"\u003e\u003cp\u003e\n  \u003cdiv id\u003d\"outputImages\"\u003e\u003c/div\u003e\n\u003c/center\u003e\u003c/body\u003e\u003c/html\u003e"},{"id":"1938ac84-7da4-4db0-a208-4f91576068c7","name":"Config","type":"server_js","source":"// NB.  These globals do not survive across calls from Index.html\nvar myLabel, myOrder, myImages, myOthers, myPrevious;\n\nfunction setup() {\n  var scriptProp \u003d PropertiesService.getScriptProperties();\n  myLabel \u003d scriptProp.getProperty(\"myLabel\") || \"Comics\";\n  \n  myOrder \u003d scriptProp.getProperty(\"myOrder\") || \"\";\n  myOrder \u003d myOrder.split(\";\");\n  \n  myImages \u003d myOrder.join(\" is Missing!\u003c/center\u003e\u003c/div\u003e;\\n\u003cdiv style\u003d\u0027color:red\u0027\u003e\u003ccenter\u003e\");\n  if (myImages.length !\u003d 0) {\n    myImages \u003d \"\\n\u003cdiv style\u003d\u0027color:red\u0027\u003e\u003ccenter\u003e\" + myImages + \" is Missing!\u003c/center\u003e\u003c/div\u003e\";\n  }\n  myImages \u003d myImages.split(\";\");\n  \n  myOthers \u003d [];\n  \n  myPrevious \u003d scriptProp.getProperty(\"myPrevious\") || \"\";\n  myPrevious \u003d myPrevious.split(\" \");\n}\n\nfunction getConfig() {\n  var config \u003d {};\n  var scriptProp \u003d PropertiesService.getScriptProperties();\n  config.label \u003d scriptProp.getProperty(\"myLabel\") || \"Comics\";     \n  config.order \u003d scriptProp.getProperty(\"myOrder\") || \"\";\n  return config;\n}\n\nfunction setConfig(aConfig) {\n  var scriptProp \u003d PropertiesService.getScriptProperties();\n  scriptProp.setProperty(\"myLabel\", aConfig.label);\n  scriptProp.setProperty(\"myOrder\", aConfig.order);\n  return \"Reconfigured.  Refresh to see changes.\";\n}\n\nfunction setPrevious(aConfig) {\n  var scriptProp \u003d PropertiesService.getScriptProperties();\n  scriptProp.setProperty(\"myPrevious\", aConfig);\n  return \"It\u0027s a New Day!\"\n}\n"}]}